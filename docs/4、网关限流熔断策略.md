# ğŸ”¥ ç½‘å…³é™æµç†”æ–­ç­–ç•¥æ€»ç»“

## ğŸ“‹ ç­–ç•¥æ¶æ„æ¦‚è§ˆ

å½“å‰ç½‘å…³é¡¹ç›®å®ç°äº†ä¸€å¥—**å®Œæ•´çš„å¤šå±‚æ¬¡é™æµç†”æ–­ä¿æŠ¤ä½“ç³»**ï¼ŒåŸºäºResilience4jæ¡†æ¶ï¼Œæ”¯æŒå¤šç§é™æµç®—æ³•å’Œç†”æ–­ç­–ç•¥ï¼Œä¸ºç³»ç»Ÿæä¾›å…¨æ–¹ä½çš„ä¿æŠ¤ã€‚

## ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶æ¶æ„

### 1. **é™æµç³»ç»Ÿ** ğŸš¦

#### **AdvancedRateLimitFilter - é«˜çº§é™æµè¿‡æ»¤å™¨**
```java
@Component
public class AdvancedRateLimitFilter implements GatewayFilter, Ordered {
    // å››å±‚é™æµæ£€æŸ¥
    1. IPé™æµæ£€æŸ¥ (30 QPS, 50 burst)
    2. ç”¨æˆ·é™æµæ£€æŸ¥ (20 QPS, 35 burst)  
    3. URLè·¯å¾„é™æµæ£€æŸ¥ (40 QPS, 60 burst)
    4. APIæƒé‡é™æµæ£€æŸ¥ (åŸºäºä¸šåŠ¡ä¼˜å…ˆçº§)
}
```

#### **AdvancedRateLimiter - å¢å¼ºç‰ˆé™æµå™¨**
```java
@Component
public class AdvancedRateLimiter {
    // æ»‘åŠ¨çª—å£é™æµå™¨ - æ”¯æŒçªå‘æµé‡
    public static class SlidingWindowRateLimiter
    
    // ä»¤ç‰Œæ¡¶é™æµå™¨ - æ”¯æŒåŠ¨æ€è°ƒæ•´
    public static class TokenBucketRateLimiter
}
```

#### **LocalFirstRateLimiter - æœ¬åœ°ä¼˜å…ˆé™æµå™¨**
```java
@Component
public class LocalFirstRateLimiter {
    // æœ¬åœ°é™æµä¼˜å…ˆå¤„ç†80%æµé‡
    // åˆ†å¸ƒå¼é™æµä½œä¸ºå…œåº•
    // Redisæ•…éšœæ—¶è‡ªåŠ¨é™çº§
}
```

### 2. **ç†”æ–­ç³»ç»Ÿ** âš¡

#### **CircuitBreakerFilter - ç†”æ–­å™¨è¿‡æ»¤å™¨**
```java
@Component
public class CircuitBreakerFilter implements GatewayFilter, Ordered {
    // åŸºäºAPIä¼˜å…ˆçº§é€‰æ‹©ç†”æ–­å™¨
    // æ”¯æŒè‡ªåŠ¨çŠ¶æ€è½¬æ¢
    // æä¾›é™çº§å¤„ç†
}
```

#### **GatewayCircuitBreakerConfig - ç†”æ–­å™¨é…ç½®**
```java
@Configuration
public class GatewayCircuitBreakerConfig {
    // æ ¸å¿ƒAPIç†”æ–­å™¨ (50%å¤±è´¥ç‡)
    // æ™®é€šAPIç†”æ–­å™¨ (30%å¤±è´¥ç‡)
    // éæ ¸å¿ƒAPIç†”æ–­å™¨ (20%å¤±è´¥ç‡)
    // åŠ è§£å¯†APIç†”æ–­å™¨ (40%å¤±è´¥ç‡)
}
```

## ğŸ“Š é™æµç­–ç•¥è¯¦è§£

### 1. **å››å±‚é™æµæ¶æ„**

#### **ç¬¬ä¸€å±‚ï¼šIPé™æµ**
```yaml
# IPé™æµé…ç½® - é˜²æ­¢å•ä¸ªIPæ”»å‡»
ip-limit-enabled: true
ip-qps: 30          # å•ä¸ªIPæ¯ç§’æœ€å¤š30ä¸ªè¯·æ±‚
ip-burst: 50        # çªå‘æµé‡å…è®¸50ä¸ªè¯·æ±‚
```
**ç®—æ³•ï¼š** æ»‘åŠ¨çª—å£ç®—æ³•
**ç›®çš„ï¼š** é˜²æ­¢æ¶æ„IPæ”»å‡»ï¼Œä¿æŠ¤ç³»ç»Ÿæ•´ä½“

#### **ç¬¬äºŒå±‚ï¼šç”¨æˆ·é™æµ**
```yaml
# ç”¨æˆ·é™æµé…ç½® - é˜²æ­¢å•ä¸ªç”¨æˆ·è¿‡åº¦ä½¿ç”¨
user-limit-enabled: true
user-qps: 20        # å•ä¸ªç”¨æˆ·æ¯ç§’æœ€å¤š20ä¸ªè¯·æ±‚
user-burst: 35      # çªå‘æµé‡å…è®¸35ä¸ªè¯·æ±‚
```
**ç®—æ³•ï¼š** æ»‘åŠ¨çª—å£ç®—æ³•
**ç›®çš„ï¼š** é˜²æ­¢å•ä¸ªç”¨æˆ·è¿‡åº¦ä½¿ç”¨èµ„æº

#### **ç¬¬ä¸‰å±‚ï¼šURLè·¯å¾„é™æµ**
```yaml
# URLè·¯å¾„é™æµé…ç½® - é˜²æ­¢çƒ­ç‚¹APIè¢«è¿‡åº¦è°ƒç”¨
url-limit-enabled: true
url-qps: 40         # å•ä¸ªURLæ¯ç§’æœ€å¤š40ä¸ªè¯·æ±‚
url-burst: 60       # çªå‘æµé‡å…è®¸60ä¸ªè¯·æ±‚
```
**ç®—æ³•ï¼š** æ»‘åŠ¨çª—å£ç®—æ³•
**ç›®çš„ï¼š** é˜²æ­¢çƒ­ç‚¹APIè¢«è¿‡åº¦è°ƒç”¨

#### **ç¬¬å››å±‚ï¼šAPIæƒé‡é™æµ**
```yaml
# APIæƒé‡é™æµé…ç½® - æ ¹æ®ä¸šåŠ¡é‡è¦æ€§åˆ†é…èµ„æº
api-weights:
  CORE:             # æ ¸å¿ƒAPIï¼šæ”¯ä»˜ã€è½¬è´¦ç­‰å…³é”®ä¸šåŠ¡
    qps: 60         # å ç”¨60%çš„ç³»ç»Ÿèµ„æº
    burst: 80
    weight: 1.0
  NORMAL:           # æ™®é€šAPIï¼šä¸€èˆ¬ä¸šåŠ¡æŸ¥è¯¢
    qps: 25         # å ç”¨25%çš„ç³»ç»Ÿèµ„æº
    burst: 35
    weight: 0.4
  NON_CORE:         # éæ ¸å¿ƒAPIï¼šç»Ÿè®¡ã€æŠ¥è¡¨ç­‰
    qps: 10         # å ç”¨10%çš„ç³»ç»Ÿèµ„æº
    burst: 15
    weight: 0.2
  CRYPTO:           # åŠ è§£å¯†APIï¼šç‰¹æ®Šå¤„ç†
    qps: 15         # å ç”¨15%çš„ç³»ç»Ÿèµ„æº
    burst: 20
    weight: 0.3
```
**ç®—æ³•ï¼š** ä»¤ç‰Œæ¡¶ç®—æ³•
**ç›®çš„ï¼š** æ ¹æ®ä¸šåŠ¡é‡è¦æ€§åˆç†åˆ†é…ç³»ç»Ÿèµ„æº

### 2. **é™æµç®—æ³•å®ç°**

#### **æ»‘åŠ¨çª—å£ç®—æ³•**
```java
public static class SlidingWindowRateLimiter {
    private final int windowSize; // çª—å£å¤§å°ï¼ˆç§’ï¼‰
    private final int maxRequests; // æœ€å¤§è¯·æ±‚æ•°
    private final int burstSize; // çªå‘æµé‡å¤§å°
    
    public synchronized boolean tryAcquire() {
        // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ›å»ºæ–°çª—å£
        // è®¡ç®—å½“å‰çª—å£å†…çš„è¯·æ±‚æ•°
        // æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶
        // æ”¯æŒçªå‘æµé‡é…é¢
    }
}
```

#### **ä»¤ç‰Œæ¡¶ç®—æ³•**
```java
public static class TokenBucketRateLimiter {
    private final long capacity; // æ¡¶å®¹é‡ï¼ˆburstï¼‰
    private final long refillRate; // æ¯ç§’è¡¥å……é€Ÿç‡ï¼ˆQPSï¼‰
    
    public synchronized boolean tryAcquire() {
        // è¡¥å……ä»¤ç‰Œ
        // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿä»¤ç‰Œ
        // æ¶ˆè´¹ä»¤ç‰Œ
    }
}
```

### 3. **åˆ†å¸ƒå¼é™æµ**

#### **Redisåˆ†å¸ƒå¼é™æµ**
```java
@Component
public class RedisRateLimiter {
    // æ»‘åŠ¨çª—å£é™æµ - Redis Sorted Setå®ç°
    public Mono<Boolean> slidingWindowRateLimit()
    
    // ä»¤ç‰Œæ¡¶é™æµ - Redis Hashå®ç°
    public Mono<Boolean> tokenBucketRateLimit()
    
    // å›ºå®šçª—å£é™æµ - Redis INCR + EXPIREå®ç°
    public Mono<Boolean> fixedWindowRateLimit()
}
```

#### **æœ¬åœ°ä¼˜å…ˆç­–ç•¥**
```java
public class LocalFirstRateLimiter {
    // æœ¬åœ°é™æµä¼˜å…ˆå¤„ç†80%æµé‡
    // åˆ†å¸ƒå¼é™æµä½œä¸ºå…œåº•
    // Redisæ•…éšœæ—¶è‡ªåŠ¨é™çº§ä¸ºçº¯æœ¬åœ°é™æµ
}
```

## âš¡ ç†”æ–­ç­–ç•¥è¯¦è§£

### 1. **ç†”æ–­å™¨ç±»å‹**

#### **æ ¸å¿ƒAPIç†”æ–­å™¨**
```java
@Bean("coreApiCircuitBreaker")
public CircuitBreaker coreApiCircuitBreaker() {
    CircuitBreakerConfig config = CircuitBreakerConfig.custom()
        .slidingWindowSize(10)                    // æ»‘åŠ¨çª—å£å¤§å°
        .minimumNumberOfCalls(5)                  // æœ€å°è°ƒç”¨æ¬¡æ•°
        .permittedNumberOfCallsInHalfOpenState(3) // åŠå¼€çŠ¶æ€å…è®¸è°ƒç”¨æ•°
        .waitDurationInOpenState(Duration.ofSeconds(5)) // å¼€å¯çŠ¶æ€ç­‰å¾…æ—¶é—´
        .failureRateThreshold(50.0f)              // å¤±è´¥ç‡é˜ˆå€¼50%
        .slowCallRateThreshold(50.0f)             // æ…¢è°ƒç”¨ç‡é˜ˆå€¼50%
        .slowCallDurationThreshold(Duration.ofSeconds(2)) // æ…¢è°ƒç”¨æ—¶é—´é˜ˆå€¼
        .build();
}
```

#### **æ™®é€šAPIç†”æ–­å™¨**
```java
@Bean("normalApiCircuitBreaker")
public CircuitBreaker normalApiCircuitBreaker() {
    CircuitBreakerConfig config = CircuitBreakerConfig.custom()
        .slidingWindowSize(20)                    // æ›´å¤§çš„æ»‘åŠ¨çª—å£
        .minimumNumberOfCalls(10)                 // æ›´å¤šçš„æœ€å°è°ƒç”¨æ¬¡æ•°
        .permittedNumberOfCallsInHalfOpenState(5) // æ›´å¤šåŠå¼€çŠ¶æ€è°ƒç”¨æ•°
        .waitDurationInOpenState(Duration.ofSeconds(10)) // æ›´é•¿çš„ç­‰å¾…æ—¶é—´
        .failureRateThreshold(30.0f)              // æ›´ä½çš„å¤±è´¥ç‡é˜ˆå€¼30%
        .slowCallRateThreshold(30.0f)             // æ›´ä½çš„æ…¢è°ƒç”¨ç‡é˜ˆå€¼30%
        .slowCallDurationThreshold(Duration.ofSeconds(5)) // æ›´é•¿çš„æ…¢è°ƒç”¨æ—¶é—´é˜ˆå€¼
        .build();
}
```

#### **éæ ¸å¿ƒAPIç†”æ–­å™¨**
```java
@Bean("nonCoreApiCircuitBreaker")
public CircuitBreaker nonCoreApiCircuitBreaker() {
    CircuitBreakerConfig config = CircuitBreakerConfig.custom()
        .slidingWindowSize(30)                    // æœ€å¤§çš„æ»‘åŠ¨çª—å£
        .minimumNumberOfCalls(15)                 // æœ€å¤šçš„æœ€å°è°ƒç”¨æ¬¡æ•°
        .permittedNumberOfCallsInHalfOpenState(8) // æœ€å¤šçš„åŠå¼€çŠ¶æ€è°ƒç”¨æ•°
        .waitDurationInOpenState(Duration.ofSeconds(15)) // æœ€é•¿çš„ç­‰å¾…æ—¶é—´
        .failureRateThreshold(20.0f)              // æœ€ä½çš„å¤±è´¥ç‡é˜ˆå€¼20%
        .slowCallRateThreshold(20.0f)             // æœ€ä½çš„æ…¢è°ƒç”¨ç‡é˜ˆå€¼20%
        .slowCallDurationThreshold(Duration.ofSeconds(10)) // æœ€é•¿çš„æ…¢è°ƒç”¨æ—¶é—´é˜ˆå€¼
        .build();
}
```

#### **åŠ è§£å¯†APIç†”æ–­å™¨**
```java
@Bean("cryptoApiCircuitBreaker")
public CircuitBreaker cryptoApiCircuitBreaker() {
    CircuitBreakerConfig config = CircuitBreakerConfig.custom()
        .slidingWindowSize(15)                    // ä¸­ç­‰æ»‘åŠ¨çª—å£
        .minimumNumberOfCalls(8)                  // ä¸­ç­‰æœ€å°è°ƒç”¨æ¬¡æ•°
        .permittedNumberOfCallsInHalfOpenState(4) // ä¸­ç­‰åŠå¼€çŠ¶æ€è°ƒç”¨æ•°
        .waitDurationInOpenState(Duration.ofSeconds(8)) // ä¸­ç­‰ç­‰å¾…æ—¶é—´
        .failureRateThreshold(40.0f)              // ä¸­ç­‰å¤±è´¥ç‡é˜ˆå€¼40%
        .slowCallRateThreshold(40.0f)             // ä¸­ç­‰æ…¢è°ƒç”¨ç‡é˜ˆå€¼40%
        .slowCallDurationThreshold(Duration.ofSeconds(3)) // ä¸­ç­‰æ…¢è°ƒç”¨æ—¶é—´é˜ˆå€¼
        .recordExceptions(GeneralSecurityException.class) // è®°å½•å®‰å…¨å¼‚å¸¸
        .build();
}
```

### 2. **ç†”æ–­å™¨çŠ¶æ€è½¬æ¢**

#### **çŠ¶æ€æœº**
```
CLOSED (å…³é—­) â†â†’ OPEN (å¼€å¯) â†â†’ HALF_OPEN (åŠå¼€)
    â†“              â†“              â†“
  æ­£å¸¸å¤„ç†      å¿«é€Ÿå¤±è´¥        è¯•æ¢æ€§æ¢å¤
```

#### **çŠ¶æ€è½¬æ¢æ¡ä»¶**
- **CLOSED â†’ OPEN**ï¼šå¤±è´¥ç‡è¶…è¿‡é˜ˆå€¼æˆ–æ…¢è°ƒç”¨ç‡è¶…è¿‡é˜ˆå€¼
- **OPEN â†’ HALF_OPEN**ï¼šç­‰å¾…æ—¶é—´åˆ°æœŸï¼Œè‡ªåŠ¨è½¬æ¢
- **HALF_OPEN â†’ CLOSED**ï¼šè¯•æ¢è°ƒç”¨æˆåŠŸ
- **HALF_OPEN â†’ OPEN**ï¼šè¯•æ¢è°ƒç”¨å¤±è´¥

### 3. **ç†”æ–­å™¨é…ç½®å‚æ•°**

| å‚æ•° | æ ¸å¿ƒAPI | æ™®é€šAPI | éæ ¸å¿ƒAPI | åŠ è§£å¯†API |
|------|---------|---------|-----------|-----------|
| æ»‘åŠ¨çª—å£å¤§å° | 10 | 20 | 30 | 15 |
| æœ€å°è°ƒç”¨æ¬¡æ•° | 5 | 10 | 15 | 8 |
| åŠå¼€çŠ¶æ€è°ƒç”¨æ•° | 3 | 5 | 8 | 4 |
| ç­‰å¾…æ—¶é—´(ç§’) | 5 | 10 | 15 | 8 |
| å¤±è´¥ç‡é˜ˆå€¼(%) | 50 | 30 | 20 | 40 |
| æ…¢è°ƒç”¨ç‡é˜ˆå€¼(%) | 50 | 30 | 20 | 40 |
| æ…¢è°ƒç”¨æ—¶é—´é˜ˆå€¼(ç§’) | 2 | 5 | 10 | 3 |

## ğŸ”„ é™æµç†”æ–­ååŒæœºåˆ¶

### 1. **æ‰§è¡Œé¡ºåº**
```
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. é™æµè¿‡æ»¤å™¨ (AdvancedRateLimitFilter) â”‚ â† ç¬¬ä¸€å±‚é˜²æŠ¤
â”‚    - IPé™æµ (30 QPS)                â”‚
â”‚    - ç”¨æˆ·é™æµ (20 QPS)              â”‚
â”‚    - URLé™æµ (40 QPS)               â”‚
â”‚    - APIæƒé‡é™æµ (CORE:60, NORMAL:25) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (é™æµé€šè¿‡)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ç†”æ–­å™¨è¿‡æ»¤å™¨ (CircuitBreakerFilter) â”‚ â† ç¬¬äºŒå±‚é˜²æŠ¤
â”‚    - æ ¸å¿ƒAPIç†”æ–­å™¨ (50%å¤±è´¥ç‡)       â”‚
â”‚    - æ™®é€šAPIç†”æ–­å™¨ (30%å¤±è´¥ç‡)       â”‚
â”‚    - éæ ¸å¿ƒAPIç†”æ–­å™¨ (20%å¤±è´¥ç‡)     â”‚
â”‚    - åŠ è§£å¯†APIç†”æ–­å™¨ (40%å¤±è´¥ç‡)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (ç†”æ–­é€šè¿‡)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ä¸šåŠ¡å¤„ç†å±‚                        â”‚
â”‚    - è·¯ç”±è½¬å‘                        â”‚
â”‚    - åŠ è§£å¯†å¤„ç†                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
åç«¯æœåŠ¡
```

### 2. **è·¯ç”±é…ç½®ä¸­çš„è¿‡æ»¤å™¨é“¾**
```java
// æ”¯ä»˜æœåŠ¡è·¯ç”± - æ ¸å¿ƒAPI
.route("payment-route", r -> r
    .path("/api/gateway/payment/**")
    .filters(f -> f
        .rewritePath("/api/gateway/payment/(?<segment>.*)", "/api/payment/${segment}")
        .filter(advancedRateLimitFilter)     // 1. é™æµè¿‡æ»¤å™¨
        .filter(serviceDegradationGatewayFilter) // 2. æœåŠ¡é™çº§è¿‡æ»¤å™¨
        .filter(circuitBreakerFilter)        // 3. ç†”æ–­å™¨è¿‡æ»¤å™¨
        .filter(cryptoFilter)               // 4. åŠ è§£å¯†è¿‡æ»¤å™¨
    )
    .uri("http://localhost:8081")
)
```

## ğŸ“ˆ ç›‘æ§ä¸ç»Ÿè®¡

### 1. **é™æµç›‘æ§**

#### **é™æµç»Ÿè®¡æŒ‡æ ‡**
```java
// é™æµç»Ÿè®¡è®¡æ•°å™¨
private final AtomicLong ipLimitCount = new AtomicLong(0);
private final AtomicLong userLimitCount = new AtomicLong(0);
private final AtomicLong urlLimitCount = new AtomicLong(0);
private final AtomicLong apiWeightLimitCount = new AtomicLong(0);
```

#### **é™æµå™¨çŠ¶æ€**
```java
public static class RateLimiterStatus {
    private String type;           // é™æµå™¨ç±»å‹
    private long currentCount;     // å½“å‰è®¡æ•°
    private double utilizationRate; // åˆ©ç”¨ç‡
    private double rejectionRate;  // æ‹’ç»ç‡
    private String status;         // çŠ¶æ€
}
```

### 2. **ç†”æ–­ç›‘æ§**

#### **ç†”æ–­å™¨çŠ¶æ€**
```java
// ç†”æ–­å™¨çŠ¶æ€ç›‘æ§
public Map<String, Object> getCircuitBreakerStatus() {
    Map<String, Object> status = new HashMap<>();
    status.put("coreApi", getCircuitBreakerMetrics(coreApiCircuitBreaker));
    status.put("normalApi", getCircuitBreakerMetrics(normalApiCircuitBreaker));
    status.put("nonCoreApi", getCircuitBreakerMetrics(nonCoreApiCircuitBreaker));
    status.put("cryptoApi", getCircuitBreakerMetrics(cryptoApiCircuitBreaker));
    return status;
}
```

#### **ç†”æ–­å™¨æŒ‡æ ‡**
- **å¤±è´¥ç‡**ï¼šå¤±è´¥è¯·æ±‚å æ€»è¯·æ±‚çš„æ¯”ä¾‹
- **æ…¢è°ƒç”¨ç‡**ï¼šæ…¢è°ƒç”¨å æ€»è°ƒç”¨çš„æ¯”ä¾‹
- **çŠ¶æ€**ï¼šCLOSEDã€OPENã€HALF_OPEN
- **è°ƒç”¨æ¬¡æ•°**ï¼šæ€»è°ƒç”¨æ¬¡æ•°ã€æˆåŠŸæ¬¡æ•°ã€å¤±è´¥æ¬¡æ•°

### 3. **ç›‘æ§APIæ¥å£**

#### **é™æµç›‘æ§æ¥å£**
```http
GET /api/gateway/monitor/rate-limit
GET /api/gateway/monitor/rate-limit/stats
GET /api/gateway/monitor/rate-limit/status
```

#### **ç†”æ–­ç›‘æ§æ¥å£**
```http
GET /api/gateway/monitor/circuit-breaker
GET /api/gateway/monitor/circuit-breaker/stats
GET /api/gateway/monitor/circuit-breaker/status
```

## ğŸ”§ é…ç½®ç®¡ç†

### 1. **é™æµé…ç½®**

#### **åŸºç¡€é™æµé…ç½®**
```yaml
gateway:
  rate-limit:
    enabled: true
    # å…¨å±€é»˜è®¤é™æµé…ç½®
    default-qps: 80
    default-burst: 120
    
    # IPé™æµé…ç½®
    ip-limit-enabled: true
    ip-qps: 30
    ip-burst: 50
    
    # ç”¨æˆ·é™æµé…ç½®
    user-limit-enabled: true
    user-qps: 20
    user-burst: 35
    
    # URLè·¯å¾„é™æµé…ç½®
    url-limit-enabled: true
    url-qps: 40
    url-burst: 60
    
    # APIæƒé‡é™æµé…ç½®
    api-weight-limit-enabled: true
    api-weights:
      CORE:
        qps: 60
        burst: 80
        weight: 1.0
      NORMAL:
        qps: 25
        burst: 35
        weight: 0.4
      NON_CORE:
        qps: 10
        burst: 15
        weight: 0.2
      CRYPTO:
        qps: 15
        burst: 20
        weight: 0.3
```

#### **é™æµé¡ºåºé…ç½®**
```yaml
rate:
  limit:
    order:
      # æ€§èƒ½ä¼˜å…ˆç­–ç•¥ï¼šä»ä¸¥æ ¼åˆ°å®½æ¾ï¼Œå¿«é€Ÿå¤±è´¥
      sequence: "IP,USER,URL,API_WEIGHT"
      
      # ä¸šåŠ¡ä¼˜å…ˆç­–ç•¥ï¼šä»å®½æ¾åˆ°ä¸¥æ ¼ï¼Œä¿æŠ¤ä¸šåŠ¡é€»è¾‘
      # sequence: "API_WEIGHT,URL,USER,IP"
      
      # å®‰å…¨ä¼˜å…ˆç­–ç•¥ï¼šIPå’Œç”¨æˆ·ä¼˜å…ˆï¼Œé˜²æ­¢æ¶æ„æ”»å‡»
      # sequence: "IP,USER,API_WEIGHT,URL"
```

### 2. **ç†”æ–­é…ç½®**

#### **ç†”æ–­å™¨é…ç½®**
```yaml
resilience4j:
  circuitbreaker:
    instances:
      payment-circuit-breaker:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 30s
        permitted-number-of-calls-in-half-open-state: 3
      user-circuit-breaker:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 30s
        permitted-number-of-calls-in-half-open-state: 3
      query-circuit-breaker:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 30s
        permitted-number-of-calls-in-half-open-state: 3
      statistics-circuit-breaker:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 30s
        permitted-number-of-calls-in-half-open-state: 3
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. **é™æµæ€§èƒ½ä¼˜åŒ–**

#### **ç¼“å­˜ä¼˜åŒ–**
- **æœ¬åœ°ç¼“å­˜**ï¼šä½¿ç”¨Caffeineç¼“å­˜é™æµå™¨çŠ¶æ€
- **åˆ†å¸ƒå¼ç¼“å­˜**ï¼šRedisç¼“å­˜åˆ†å¸ƒå¼é™æµæ•°æ®
- **ç¼“å­˜è¿‡æœŸ**ï¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸç¼“å­˜æ•°æ®

#### **ç®—æ³•ä¼˜åŒ–**
- **æ»‘åŠ¨çª—å£**ï¼šæ”¯æŒçªå‘æµé‡å¤„ç†
- **ä»¤ç‰Œæ¡¶**ï¼šæ”¯æŒåŠ¨æ€è°ƒæ•´å’Œçªå‘æµé‡
- **æœ¬åœ°ä¼˜å…ˆ**ï¼šå‡å°‘ç½‘ç»œå¼€é”€

### 2. **ç†”æ–­æ€§èƒ½ä¼˜åŒ–**

#### **çŠ¶æ€ç®¡ç†**
- **å†…å­˜çŠ¶æ€**ï¼šç†”æ–­å™¨çŠ¶æ€å­˜å‚¨åœ¨å†…å­˜ä¸­
- **å¿«é€Ÿåˆ‡æ¢**ï¼šçŠ¶æ€è½¬æ¢æ— é”æ“ä½œ
- **è‡ªåŠ¨æ¢å¤**ï¼šæ”¯æŒè‡ªåŠ¨çŠ¶æ€æ¢å¤

#### **å¼‚å¸¸å¤„ç†**
- **å¼‚å¸¸åˆ†ç±»**ï¼šåŒºåˆ†å¯æ¢å¤å’Œä¸å¯æ¢å¤å¼‚å¸¸
- **å¿«é€Ÿå¤±è´¥**ï¼šç†”æ–­å¼€å¯æ—¶å¿«é€Ÿè¿”å›å¤±è´¥
- **é™çº§å¤„ç†**ï¼šæä¾›é™çº§å“åº”

### 3. **ç›‘æ§æ€§èƒ½ä¼˜åŒ–**

#### **å¼‚æ­¥ç»Ÿè®¡**
- **å¼‚æ­¥æ›´æ–°**ï¼šç»Ÿè®¡ä¿¡æ¯å¼‚æ­¥æ›´æ–°
- **æ‰¹é‡å¤„ç†**ï¼šæ‰¹é‡æ›´æ–°ç»Ÿè®¡æŒ‡æ ‡
- **å†…å­˜ä¼˜åŒ–**ï¼šä½¿ç”¨åŸå­æ“ä½œå‡å°‘é”ç«äº‰

## ğŸ›¡ï¸ é«˜å¯ç”¨ä¿éšœ

### 1. **æ•…éšœæ¢å¤**

#### **é™æµæ•…éšœæ¢å¤**
- **Redisæ•…éšœé™çº§**ï¼šè‡ªåŠ¨é™çº§ä¸ºæœ¬åœ°é™æµ
- **æœ¬åœ°é™æµå…œåº•**ï¼šç¡®ä¿åŸºæœ¬é™æµåŠŸèƒ½
- **é…ç½®çƒ­æ›´æ–°**ï¼šæ”¯æŒè¿è¡Œæ—¶é…ç½®æ›´æ–°

#### **ç†”æ–­æ•…éšœæ¢å¤**
- **è‡ªåŠ¨æ¢å¤**ï¼šæ”¯æŒè‡ªåŠ¨çŠ¶æ€æ¢å¤
- **æ‰‹åŠ¨é‡ç½®**ï¼šæ”¯æŒæ‰‹åŠ¨é‡ç½®ç†”æ–­å™¨
- **å¥åº·æ£€æŸ¥**ï¼šå®šæœŸæ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€

### 2. **è´Ÿè½½ä¿æŠ¤**

#### **å¤šç»´åº¦é™æµ**
- **IPç»´åº¦**ï¼šé˜²æ­¢IPæ”»å‡»
- **ç”¨æˆ·ç»´åº¦**ï¼šé˜²æ­¢ç”¨æˆ·æ»¥ç”¨
- **APIç»´åº¦**ï¼šé˜²æ­¢APIè¿‡è½½
- **ä¸šåŠ¡ç»´åº¦**ï¼šæŒ‰ä¸šåŠ¡é‡è¦æ€§åˆ†é…èµ„æº

#### **æ™ºèƒ½ç†”æ–­**
- **å¤±è´¥ç‡ç†”æ–­**ï¼šåŸºäºå¤±è´¥ç‡è‡ªåŠ¨ç†”æ–­
- **æ…¢è°ƒç”¨ç†”æ–­**ï¼šåŸºäºå“åº”æ—¶é—´è‡ªåŠ¨ç†”æ–­
- **å¼‚å¸¸ç†”æ–­**ï¼šåŸºäºå¼‚å¸¸ç±»å‹è‡ªåŠ¨ç†”æ–­

### 3. **ç›‘æ§å‘Šè­¦**

#### **é™æµå‘Šè­¦**
- **é™æµé˜ˆå€¼å‘Šè­¦**ï¼šè¶…è¿‡é™æµé˜ˆå€¼æ—¶å‘Šè­¦
- **é™æµå™¨æ•…éšœå‘Šè­¦**ï¼šé™æµå™¨æ•…éšœæ—¶å‘Šè­¦
- **æ€§èƒ½æŒ‡æ ‡å‘Šè­¦**ï¼šæ€§èƒ½æŒ‡æ ‡å¼‚å¸¸æ—¶å‘Šè­¦

#### **ç†”æ–­å‘Šè­¦**
- **ç†”æ–­å¼€å¯å‘Šè­¦**ï¼šç†”æ–­å™¨å¼€å¯æ—¶å‘Šè­¦
- **ç†”æ–­æ¢å¤å‘Šè­¦**ï¼šç†”æ–­å™¨æ¢å¤æ—¶å‘Šè­¦
- **å¼‚å¸¸ç‡å‘Šè­¦**ï¼šå¼‚å¸¸ç‡è¿‡é«˜æ—¶å‘Šè­¦

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. **é™æµæœ€ä½³å®è·µ**

#### **é…ç½®å»ºè®®**
- **åˆç†è®¾ç½®QPS**ï¼šæ ¹æ®ç³»ç»Ÿå®¹é‡è®¾ç½®åˆç†çš„QPS
- **æ”¯æŒçªå‘æµé‡**ï¼šé…ç½®é€‚å½“çš„çªå‘æµé‡é…é¢
- **åˆ†å±‚é™æµ**ï¼šå®ç°å¤šå±‚æ¬¡çš„é™æµä¿æŠ¤

#### **ç›‘æ§å»ºè®®**
- **å®æ—¶ç›‘æ§**ï¼šå®æ—¶ç›‘æ§é™æµçŠ¶æ€
- **å‘Šè­¦è®¾ç½®**ï¼šè®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼
- **æ€§èƒ½åˆ†æ**ï¼šå®šæœŸåˆ†æé™æµæ€§èƒ½

### 2. **ç†”æ–­æœ€ä½³å®è·µ**

#### **é…ç½®å»ºè®®**
- **åˆç†è®¾ç½®é˜ˆå€¼**ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è®¾ç½®åˆç†çš„é˜ˆå€¼
- **æ”¯æŒè‡ªåŠ¨æ¢å¤**ï¼šé…ç½®è‡ªåŠ¨æ¢å¤æœºåˆ¶
- **å¼‚å¸¸åˆ†ç±»**ï¼šåˆç†åˆ†ç±»å¼‚å¸¸ç±»å‹

#### **ç›‘æ§å»ºè®®**
- **çŠ¶æ€ç›‘æ§**ï¼šå®æ—¶ç›‘æ§ç†”æ–­å™¨çŠ¶æ€
- **æŒ‡æ ‡åˆ†æ**ï¼šå®šæœŸåˆ†æç†”æ–­æŒ‡æ ‡
- **å‘Šè­¦è®¾ç½®**ï¼šè®¾ç½®åˆç†çš„å‘Šè­¦è§„åˆ™

## ğŸ¯ æ€»ç»“

å½“å‰ç½‘å…³é¡¹ç›®å®ç°äº†ä¸€å¥—**ä¼ä¸šçº§çš„é™æµç†”æ–­ä¿æŠ¤ä½“ç³»**ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### âœ… **é™æµç‰¹æ€§**
1. **å››å±‚é™æµ**ï¼šIPã€ç”¨æˆ·ã€URLã€APIæƒé‡å››å±‚é™æµ
2. **å¤šç§ç®—æ³•**ï¼šæ»‘åŠ¨çª—å£ã€ä»¤ç‰Œæ¡¶ã€å›ºå®šçª—å£ç®—æ³•
3. **åˆ†å¸ƒå¼æ”¯æŒ**ï¼šRedisåˆ†å¸ƒå¼é™æµï¼Œæœ¬åœ°ä¼˜å…ˆç­–ç•¥
4. **çªå‘æµé‡**ï¼šæ”¯æŒçªå‘æµé‡å¤„ç†ï¼Œæé«˜ç³»ç»Ÿå¼¹æ€§

### âœ… **ç†”æ–­ç‰¹æ€§**
1. **å¤šçº§ç†”æ–­**ï¼šæ ¸å¿ƒã€æ™®é€šã€éæ ¸å¿ƒã€åŠ è§£å¯†å››çº§ç†”æ–­
2. **æ™ºèƒ½æ¢å¤**ï¼šæ”¯æŒè‡ªåŠ¨çŠ¶æ€æ¢å¤å’Œæ‰‹åŠ¨é‡ç½®
3. **å¼‚å¸¸åˆ†ç±»**ï¼šæ”¯æŒå¤šç§å¼‚å¸¸ç±»å‹çš„ç†”æ–­å¤„ç†
4. **é™çº§å¤„ç†**ï¼šæä¾›å®Œå–„çš„é™çº§å“åº”æœºåˆ¶

### âœ… **ååŒç‰¹æ€§**
1. **å±‚æ¬¡é˜²æŠ¤**ï¼šé™æµåœ¨å‰ï¼Œç†”æ–­åœ¨åï¼Œå½¢æˆåŒé‡ä¿æŠ¤
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šæœ¬åœ°ä¼˜å…ˆï¼Œç¼“å­˜ä¼˜åŒ–ï¼Œå¼‚æ­¥å¤„ç†
3. **ç›‘æ§å®Œå–„**ï¼šå®æ—¶ç›‘æ§ï¼Œç»Ÿè®¡æŒ‡æ ‡ï¼Œå‘Šè­¦æœºåˆ¶
4. **é«˜å¯ç”¨æ€§**ï¼šæ•…éšœæ¢å¤ï¼Œè´Ÿè½½ä¿æŠ¤ï¼Œè‡ªåŠ¨é™çº§

è¿™å¥—é™æµç†”æ–­ç­–ç•¥ä¸ºç½‘å…³ç³»ç»Ÿæä¾›äº†**å…¨æ–¹ä½çš„ä¿æŠ¤èƒ½åŠ›**ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨é«˜å¹¶å‘ã€é«˜è´Ÿè½½åœºæ™¯ä¸‹çš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚ 